#include "opentestloader_struct.h"
#include "UnitTestFramework.h"

/**
 * @brief These symbols come from the linker script, they will resolve to the start and end addresses of the bss, data, and the init sections.
 * 
 */
extern const void __bss_start__;
extern const void __bss_end__;
extern const void __data_start__;
extern const void __data_end__;
extern const void __init_data_start__;

volatile const __attribute__ ((section (".opentestloader_struct"))) opentestloader_struct opentestloader = {
    .checksum = 0u,     // Reserved for the bootloader
    .version = 1u,      // Version of struct, this is here so if the struct is changed, older tests can still be run
    .send_char = 0u,    // Pointer to function where the test can send the test results, patched by the bootloader
    .run_test = &run_tests,
    // These pointers will be used to initialize RAM for the test by the bootloader
    // The reason the bootloader is responsible for this is that it can run the test multiple times
    // and set up memory protection
    .bss_start =  &__bss_start__,
    .bss_end = &__bss_end__,
    .data_start = &__data_start__,
    .data_end = &__data_end__,
    .init_start = &__init_data_start__,
};